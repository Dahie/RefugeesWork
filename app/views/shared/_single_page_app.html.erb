<%
###############################################################################
# SELECT DATA for PRESENTATION (=ARGUMENTS provided to this ERB File )
###############################################################################
params = {
  data:             [ # API: "/v0.0.1/api/campaigns"
    { # API: "/v0.0.1/api/campaigns/:integer"
      title:        'Dummy1',
      description:  'This is dummy 1',
      counter:      1
    },{
      title:        'Dummy2',
      description:  'This is dummy 2',
      counter:      2
    }
  ],
  collection:       { # API: "/v0.0.1/api/campaigns/collection"
    title:          ['Dummy1', 'Dummy2'],
    description:    ['This is dummy 1', 'This is dummy 2'],
    counter:        [1, 2]
  },
  schema:           { # API: "/v0.0.1/api/campaigns/schema"
    title:          'string',
    description:    'string',
    counter:        'integer'
  },
  user:             { # API: "/v0.0.1/api/user?email=xxx&password=xxx&secret=xxx"
    id:             @current_user.try(:id),
    name:           @current_user.try(:name),
    email:          @current_user.try(:email),
    secret:         form_authenticity_token
  },
  containerID:      'CONTENT'
}
###############################################################################
# VALIDATE CONTRACT (Between FRONTEND DEV and BACKEND DEV)
###############################################################################
V8::Context.new do |v8|
v8.load("app/assets/javascripts/APP.bundle.js")
if v8.eval('APP.VALIDATE()') # but pass in 'params'
#############################################################################%>
<!--:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
    COMPONENT STYLING - (In Stylus)
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::-->
<link rel='stylesheet' type='text/css' href='./assets/APP.css'>
<!--:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
    SERVER SIDE - RENDER WEB COMPONENTS - (for SEO & google crawler)
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::-->
<div id='<%=params[:CONTAINER]%>'>
<%=###########################################################################
  # SERVER SIDE - INIT
  #
  # [COMPONENT DOM INITIALIZATION & RENDERING (for SEO & google crawler)]
  # Render TEMPLATE on the Server Side
  # + data-* attributes is where client side updates will go
  # ==> with MutationObserver on data-* attributes
  #
  # @TODO: This is currently so slow with "TheRubyRacer",
  #       that it is not a viable option, thats why "is_rendered" is set
  #       to "false", for further details, see:
  #       http://confluence.ikusei.de/display/IKU/Dual+Side+Templating
  # ==> needs to use "PLATES.JS" or faster method - currently this is broken.
  #
  #############################################################################
  if is_rendered = false      # set to true to render server side
    v8.scope.APP.INIT(params)
  end
###############################################################################
%></div>
<!--:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
  CLIENT SIDE - [INIT] & START
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::-->
<script type="text/javascript" src='/assets/APP.bundle.js'></script>
<script>
  var params = <%=is_rendered%> ? false
    : JSON.parse('<%=escape_javascript(params.to_json.html_safe)%>');
  window.onload = function () { APP.INIT(params).START(); };
</script>
<!--::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::-->
        <%else%><h1>Received invalid DATA from backend</h1><%end end%>
<!--::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::-->





<!--:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
  TEST TEMPLATING
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::-->
<a id="LAYOUT" href="#LAYOUT"> Single Page Layout </a><br>
<hr><%= params %><br><hr><br>
  <h1> Plates Template SPIKE </h1>
  <div id="content"></div><hr>
  <div id="RESULT"></div><hr>
<div id="DEVELOP_MODE" style="position: absolute; left: 5%; width: 90%"></div>
